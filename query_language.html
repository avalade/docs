

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Dalmatiner Query Language &mdash; DalmatinerDB 0.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="DalmatinerDB 0.1.0 documentation" href="index.html"/>
        <link rel="prev" title="TCP Protocol" href="tcp_proto.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> DalmatinerDB</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#binaries">Binaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#from-sorce">From Sorce</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ingres.html">Data Input</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ingres.html#metric-package">Metric Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="ingres.html#data-section">Data Section</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tcp_proto.html">TCP Protocol</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Dalmatiner Query Language</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-types">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aggregation-functions">Aggregation Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manipulation-functions">Manipulation Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">DalmatinerDB</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Dalmatiner Query Language</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="dalmatiner-query-language">
<h1>Dalmatiner Query Language<a class="headerlink" href="#dalmatiner-query-language" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general">
<h2>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<p>The frontend query language is rather remotely related to SQL, this should make it simple to pick up. The focus is on querying a metric at a time given those queries are incredible fast, however globs can be used to query multiple metrics at a time.</p>
<p>The basic syntax looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT &lt;FIELDS&gt; [ FROM &lt;ALIASES&gt;] &lt;TIME RANGE&gt; [IN &lt;RESOLUTION&gt;]
</pre></div>
</div>
<p>Please keep in mind that each query can only return a single row of data at the moment.</p>
<div class="section" id="fields-select-section">
<h3>Fields (<cite>SELECT</cite> section)<a class="headerlink" href="#fields-select-section" title="Permalink to this headline">¶</a></h3>
<p>A field can either be a metric, a alias to a metric or a function:</p>
<ul class="simple">
<li><cite>cloud.zones.cpu.usage.eca485cf-bdbb-4ae5-aba9-dce767 BUCKET tachyon</cite> - a fully qualifeid metric.</li>
<li><cite>vm</cite> - an alias that is defined in the <cite>FROM</cite> section of the queryt.</li>
<li><cite>avg(vm, 1m)</cite> - a aggregation function.</li>
</ul>
<p>Fields can be aliased for output adding a <cite>AS &lt;alias&gt;</cite> directive after the field.</p>
<p>Multiple fields can be given seperating two fields with a <cite>,</cite>. The resolution of fields do not have to be the same, there is no check enforcing this!</p>
</div>
<div class="section" id="aliases-from-section">
<h3>Aliases (<cite>FROM</cite> section)<a class="headerlink" href="#aliases-from-section" title="Permalink to this headline">¶</a></h3>
<p>When a metric is used multime times it often gets more readable to alias this metric, this is done in the <cite>FROM</cite> section. Multiple elements can be given seperated with a <cite>,</cite>. Each element takes the form: <cite>&lt;metric&gt; BUCKET &lt;bucket&gt; AS &lt;alias&gt;</cite>.</p>
<p>It is possible to match multiple metrics by using a mulitget aggregator and a glob to match a metric. Valid multiget aggregators are <cite>sum</cite> and <cite>avg</cite>. For example: <cite>sum(some.metric.* BUCKET b)</cite>.</p>
</div>
<div class="section" id="time-range">
<h3>TIME RANGE<a class="headerlink" href="#time-range" title="Permalink to this headline">¶</a></h3>
<p>There are two ways to declare ranges, while nubers here represent seconds DalmatinerDB does not care about the time unit at all:</p>
<div class="highlight-python"><div class="highlight"><pre>BETWEEN &lt;start:reltime&gt; AND &lt;end:reltime&gt;
</pre></div>
</div>
<p>Will select all pints between the <cite>start</cite> and the <cite>end</cite>. However often the most used query is &#8216;what happned in the past X seconds&#8217; so there is a simplified form for this:</p>
<div class="highlight-python"><div class="highlight"><pre>LAST &lt;amount:int&gt;|[time:time&gt;]
</pre></div>
</div>
</div>
<div class="section" id="resolution-in-section">
<h3>Resolution (<cite>IN</cite> section)<a class="headerlink" href="#resolution-in-section" title="Permalink to this headline">¶</a></h3>
<p>By default queries treat incoming data as a one second resolution, however this can be adjusted by passing a resolution section to the query, the syntax is: <cite>IN &lt;resolution:time&gt;</cite>.</p>
</div>
</div>
<div class="section" id="data-types">
<h2>Data Types<a class="headerlink" href="#data-types" title="Permalink to this headline">¶</a></h2>
<div class="section" id="integer-int">
<h3>Integer (int)<a class="headerlink" href="#integer-int" title="Permalink to this headline">¶</a></h3>
<p>A simple numern literal i.e. <cite>42</cite>.</p>
</div>
<div class="section" id="time-time">
<h3>Time (time)<a class="headerlink" href="#time-time" title="Permalink to this headline">¶</a></h3>
<p>There are two ways to declare times:</p>
<ul class="simple">
<li>relatively, in which case the time is a simple integer and corresponds to a number of metric points used. (i.e. <cite>60</cite>)</li>
<li>absolute, in which case the time is a integer followed by a time unit such as <cite>ms</cite>, <cite>s</cite>, <cite>m</cite>, <cite>h</cite>, <cite>d</cite> and <cite>w</cite>, in this case the resolution of the metric is taken into acount.</li>
</ul>
</div>
<div class="section" id="relative-time-reltime">
<h3>Relative Time (reltime)<a class="headerlink" href="#relative-time-reltime" title="Permalink to this headline">¶</a></h3>
<p>Relative times can either be the keyword <cite>NOW</cite>, a absolute timestamp (a simple integer) or a relative time in the past such as <cite>&lt;time&gt; AGO</cite>.</p>
</div>
<div class="section" id="metric">
<h3>Metric<a class="headerlink" href="#metric" title="Permalink to this headline">¶</a></h3>
<p>Metrics are simple strings that are optionally seperated by dots and a second strring for the bucket. The two strings are seperated by the keyword <cite>BUCKET</cite>.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre>cloud.zones.cpu.usage.eca485cf-bdbb-4ae5-aba9-dce767 BUCKET tachyon
</pre></div>
</div>
</div>
</div>
<div class="section" id="aggregation-functions">
<h2>Aggregation Functions<a class="headerlink" href="#aggregation-functions" title="Permalink to this headline">¶</a></h2>
<p>Aggregation functions aggregate a metric over a given range of time and decrease the resolution by doing so. Aggregation functions can be nested in which case the &#8216;higher&#8217; functiosn work with the decreased resolution of lower functions and not the raw resolution. This means the correct code to get the 1m average over 10s sums from a 1s resolution metric would be  <cite>avg(sum(m, 10s), 1m)</cite> not <cite>avg(sum(m, 10s), 6s)</cite> - however this does not apply when using the point and not the time declaration, so it would be: <cite>avg(sum(m, 10s), 6)</cite> not <cite>avg(sum(m, 10s), 60)</cite> (please note the missing <cite>s</cite>).</p>
<div class="section" id="min-2">
<h3>min/2<a class="headerlink" href="#min-2" title="Permalink to this headline">¶</a></h3>
<p>The minimal value over a given range of time.</p>
</div>
<div class="section" id="max-2">
<h3>max/2<a class="headerlink" href="#max-2" title="Permalink to this headline">¶</a></h3>
<p>The maximal value over a given range of time.</p>
</div>
<div class="section" id="sum-2">
<h3>sum/2<a class="headerlink" href="#sum-2" title="Permalink to this headline">¶</a></h3>
<p>The sum of all values of a timerange.</p>
</div>
<div class="section" id="avg-2">
<h3>avg/2<a class="headerlink" href="#avg-2" title="Permalink to this headline">¶</a></h3>
<p>The average of a timerange (this is the mean not the median).</p>
</div>
</div>
<div class="section" id="manipulation-functions">
<h2>Manipulation Functions<a class="headerlink" href="#manipulation-functions" title="Permalink to this headline">¶</a></h2>
<p>Manipulation functiosn help to change the values of a value list they do not change the resolution or aggregate multiple values into one.</p>
<div class="section" id="derivate-1">
<h3>derivate/1<a class="headerlink" href="#derivate-1" title="Permalink to this headline">¶</a></h3>
<p>Calculates the derivate of a metric, meaing N&#8217;(X)=N(X) - N(X-1)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even so the resolution isn&#8217;t changed this function removes exactly 1 element from the result</p>
</div>
</div>
<div class="section" id="multiply-2">
<h3>multiply/2<a class="headerlink" href="#multiply-2" title="Permalink to this headline">¶</a></h3>
<p>Multiplies each element with integer constant.</p>
</div>
<div class="section" id="divide-2">
<h3>divide/2<a class="headerlink" href="#divide-2" title="Permalink to this headline">¶</a></h3>
<p>Divides each element with a integer constant.</p>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Calcuates the min, max and average of a metric over a hour:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="k">min</span><span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="mi">10</span><span class="n">m</span><span class="p">),</span> <span class="k">avg</span><span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="mi">10</span><span class="n">m</span><span class="p">),</span> <span class="k">max</span><span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="mi">10</span><span class="n">m</span><span class="p">)</span> <span class="k">AS</span> <span class="k">max</span> <span class="k">FROM</span> <span class="n">cloud</span><span class="p">.</span><span class="n">zones</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="k">usage</span><span class="p">.</span><span class="n">eca485cf</span><span class="o">-</span><span class="n">bdbb</span><span class="o">-</span><span class="mi">4</span><span class="n">ae5</span><span class="o">-</span><span class="n">aba9</span><span class="o">-</span><span class="n">dce767</span> <span class="n">BUCKET</span> <span class="n">tachyon</span> <span class="k">AS</span> <span class="n">vm</span> <span class="k">LAST</span> <span class="mi">60</span><span class="n">m</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="tcp_proto.html" class="btn btn-neutral" title="TCP Protocol"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Heinz N. Gies.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>